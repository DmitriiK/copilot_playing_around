<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Schulte Table</title>
  <link rel="stylesheet" href="css/schulte_table.css">
</head>
<body>
  <h1>Schulte Table, emoji edition</h1>
  <p style="max-width: 600px; margin: 0 0 10px 0; color: #444; text-align: left;"></p>
    This is a Schulte Table game with emoji icons instead of numbers. 
    Choose a category and grid size, then click Play. 
    The main grid is filled with icons, and the order to click  is shown in "Ordered items".
   Try to finish as fast as you can!
  </p>
  <div class="controls">
    <label for="category">Category:</label>
    <select id="category">
      <option value="food">Food</option>
      <option value="animal">Animal</option>
    </select>
    <label for="grid-size">Grid size:</label>
    <select id="grid-size">
      <option value="4">4 x 4</option>
      <option value="5">5 x 5</option>
      <option value="6">6 x 6</option>
    </select>
    <button id="play-btn">Play</button>
    <button id="stop-btn" disabled>Stop</button>
    <span class="timer" id="timer">00:00</span>
  </div>
  <div style="display: flex; flex-direction: column; align-items: center;">
    <div class="bordered-box" style="margin-bottom: 0;">
      <div style="font-weight:bold; margin-bottom:6px;">Ordered items</div>
      <div class="target-row" id="target-row"></div>
    </div>
    <div class="bordered-box" style="margin-top: 10px;">
      <div class="grid" id="game-grid"></div>
    </div>
  </div>
  <script>
    const FOOD_EMOJIS = [
      'ðŸŽ','ðŸŒ','ðŸ‡','ðŸ‰','ðŸ“','ðŸ’','ðŸ‘','ðŸ','ðŸ¥','ðŸ…','ðŸ†','ðŸ¥‘','ðŸ¥•','ðŸŒ½','ðŸ¥¦','ðŸ¥”','ðŸ‹','ðŸŠ','ðŸ','ðŸ','ðŸ¥­','ðŸˆ','ðŸ¤','ðŸ ','ðŸ¥¬','ðŸ«›','ðŸ«‘','ðŸ§„','ðŸ§…','ðŸ¥’','ðŸ„','ðŸ¥œ','ðŸŒ°','ðŸž','ðŸ¥¨','ðŸ§€','ðŸ¥š','ðŸ¥“','ðŸ¥©','ðŸ—','ðŸ–','ðŸŒ­','ðŸ”','ðŸŸ','ðŸ•','ðŸ¥ª','ðŸ¥™','ðŸŒ®','ðŸŒ¯','ðŸ¥—','ðŸ²','ðŸ›','ðŸœ','ðŸ','ðŸ£','ðŸ±','ðŸ¥Ÿ','ðŸ¤','ðŸš','ðŸ˜','ðŸ¥','ðŸ¥ ','ðŸ¢','ðŸ¡','ðŸ§','ðŸ¨','ðŸ¦','ðŸ¥§','ðŸ°','ðŸŽ‚','ðŸ§','ðŸ®','ðŸ­','ðŸ¬','ðŸ«','ðŸ¿','ðŸ©','ðŸª'
    ];
    const ANIMAL_EMOJIS = [
      'ðŸ¶','ðŸ±','ðŸ­','ðŸ¹','ðŸ°','ðŸ¦Š','ðŸ»','ðŸ¼','ðŸ¨','ðŸ¯','ðŸ¦','ðŸ®','ðŸ·','ðŸ¸','ðŸµ','ðŸ”','ðŸ§','ðŸ¦','ðŸ¤','ðŸ¦†','ðŸ¦…','ðŸ¦‰','ðŸ¦‡','ðŸº','ðŸ—','ðŸ´','ðŸ¦„','ðŸ','ðŸ›','ðŸ¦‹','ðŸŒ','ðŸž','ðŸœ','ðŸª²','ðŸª³','ðŸ¦Ÿ','ðŸ¦—','ðŸ•·','ðŸ¦‚','ðŸ¢','ðŸ','ðŸ¦Ž','ðŸ¦–','ðŸ¦•','ðŸ™','ðŸ¦‘','ðŸ¦','ðŸ¦ž','ðŸ¦€','ðŸ¡','ðŸ ','ðŸŸ','ðŸ¬','ðŸ³','ðŸ‹','ðŸ¦ˆ','ðŸŠ','ðŸ…','ðŸ†','ðŸ¦“','ðŸ¦','ðŸ¦§','ðŸ˜','ðŸ¦£','ðŸ¦›','ðŸ¦','ðŸª','ðŸ«','ðŸ¦’','ðŸ¦˜','ðŸ¦¬','ðŸƒ','ðŸ‚','ðŸ„','ðŸŽ','ðŸ–','ðŸ','ðŸ‘','ðŸ¦™','ðŸ','ðŸ¦Œ','ðŸ•','ðŸ©','ðŸ¦®','ðŸ•â€ðŸ¦º','ðŸˆ','ðŸˆâ€â¬›','ðŸª¶','ðŸ“','ðŸ¦ƒ','ðŸ¦¤','ðŸ¦š','ðŸ¦œ','ðŸ¦¢','ðŸ¦©','ðŸ•Š','ðŸ‡','ðŸ¦','ðŸ¦¨','ðŸ¦¡','ðŸ¦«','ðŸ¦¦','ðŸ¦¥','ðŸ','ðŸ€','ðŸ¿','ðŸ¦”'
    ];
    let gridSize = 4;
    let order = [];
    let gridIcons = [];
    let windowSize = 4;
    let windowStart = 0;
    let playing = false;
    let timer = 0;
    let timerInterval = null;
    let currentEmojis = FOOD_EMOJIS;

    const categorySelect = document.getElementById('category');
    const gridSizeSelect = document.getElementById('grid-size');
    const playBtn = document.getElementById('play-btn');
    const stopBtn = document.getElementById('stop-btn');
    const timerEl = document.getElementById('timer');
    const targetRow = document.getElementById('target-row');
    const gameGrid = document.getElementById('game-grid');

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function startGame() {
      gridSize = parseInt(gridSizeSelect.value);
      windowSize = gridSize;
      const total = gridSize * gridSize;
      currentEmojis = categorySelect.value === 'animal' ? ANIMAL_EMOJIS : FOOD_EMOJIS;
      gridIcons = shuffle(currentEmojis.slice()).slice(0, total);
      order = shuffle(gridIcons.slice());
      windowStart = 0;
      playing = true;
      timer = 0;
      updateTimer();
      playBtn.disabled = true;
      stopBtn.disabled = false;
      gridSizeSelect.disabled = true;
      categorySelect.disabled = true;
      renderTargetRow();
      renderGrid();
      timerInterval = setInterval(() => {
        timer++;
        updateTimer();
      }, 1000);
    }

    function stopGame() {
      playing = false;
      playBtn.disabled = false;
      stopBtn.disabled = true;
      gridSizeSelect.disabled = false;
      categorySelect.disabled = false;
      clearInterval(timerInterval);
    }

    function updateTimer() {
      const min = String(Math.floor(timer / 60)).padStart(2, '0');
      const sec = String(timer % 60).padStart(2, '0');
      timerEl.textContent = `${min}:${sec}`;
    }

    function renderTargetRow() {
      targetRow.innerHTML = '';
      if (!playing) {
        // Show empty buttons before game starts
        for (let i = 0; i < windowSize; i++) {
          const btn = document.createElement('button');
          btn.className = 'target-btn';
          btn.textContent = '';
          btn.disabled = true;
          targetRow.appendChild(btn);
        }
        return;
      }
      for (let i = 0; i < windowSize; i++) {
        const idx = windowStart + i;
        if (idx < order.length) {
          const btn = document.createElement('button');
          btn.className = 'target-btn';
          btn.textContent = order[idx];
          targetRow.appendChild(btn);
        }
      }
    }

    function renderGrid() {
      gameGrid.innerHTML = '';
      gameGrid.style.gridTemplateColumns = `repeat(${gridSize}, 60px)`;
      gridIcons.forEach(icon => {
        const btn = document.createElement('button');
        btn.className = 'grid-btn';
        btn.textContent = icon;
        btn.disabled = !playing;
        btn.onclick = () => handleGridClick(icon, btn);
        gameGrid.appendChild(btn);
      });
    }

    function handleGridClick(icon, btn) {
      if (!playing) return;
      if (icon === order[windowStart]) {
        btn.disabled = true;
        btn.style.background = '#d0ffd0';
        windowStart++;
        renderTargetRow();
        // Correct finish condition: all items clicked
        if (windowStart >= order.length) {
          stopGame();
          setTimeout(() => alert(`Congratulations! Time: ${timerEl.textContent}`), 100);
        }
      } else {
        btn.classList.add('splash');
        setTimeout(() => btn.classList.remove('splash'), 350);
      }
    }

    playBtn.onclick = startGame;
    stopBtn.onclick = stopGame;
    gridSizeSelect.onchange = categorySelect.onchange = () => {
      gridSize = parseInt(gridSizeSelect.value);
      windowSize = gridSize;
      const total = gridSize * gridSize;
      currentEmojis = categorySelect.value === 'animal' ? ANIMAL_EMOJIS : FOOD_EMOJIS;
      gridIcons = shuffle(currentEmojis.slice()).slice(0, total);
      order = [];
      windowStart = 0;
      renderGrid();
      renderTargetRow();
    };
    // Initial render
    (function initialPopulate() {
      gridSize = parseInt(gridSizeSelect.value);
      windowSize = gridSize;
      const total = gridSize * gridSize;
      currentEmojis = FOOD_EMOJIS;
      gridIcons = shuffle(currentEmojis.slice()).slice(0, total);
      order = [];
      windowStart = 0;
      renderGrid();
      renderTargetRow();
    })();
  </script>
</body>
</html>
